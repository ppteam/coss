<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE sqlMap      
	PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"      
	"http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="DictRecord">
	<!-- Only For Save Action -->
	<insert id="insert" parameterClass="DictRecord">
		insert into DICT_CATALOG
			(CATALOG_ID,ENTRY_TYPE,ENABLED,ENTRY_NAME,ENTRY_SHUTNAME,ENTRY_SIRE,ENTRY_ORDER,ENTRY_DESC)
		values
			(#catalogId#,1,#enabled#,#entryName#,#entryShutName:VARCHAR#,#entrySire#,#entryOrder#,#entryDesc:VARCHAR#)
	</insert>
	<update id="updateById" parameterClass="DictRecord">
		update
			DICT_CATALOG
		set
			ENTRY_NAME = #entryName#,ENTRY_SHUTNAME = #entryShutName#,
			ENTRY_SIRE = #entrySire#,ENTRY_ORDER = #entryOrder#,
			ENTRY_DESC = #entryDesc#,ENABLED = #enabled#
		where
			CATALOG_ID = #catalogId# and
			ENTRY_TYPE = 1
	</update>
	<select id="query_ByCatalog_count" parameterClass="map" resultClass="int">
		SELECT
			COUNT(d.CATALOG_ID)
		FROM
			DICT_CATALOG d
		WHERE
			d.ENTRY_TYPE = 1
			<dynamic>
				<isNotEmpty property="entrySire" prepend=" AND">
					d.ENTRY_SIRE = #entrySire#
				</isNotEmpty>
			</dynamic>
	</select>
	<select id="query_ByCatalog" parameterClass="map" resultClass="DictRecord">
		SELECT
			d.CATALOG_ID as catalogId,d.ENTRY_NAME as entryName,d.ENTRY_SHUTNAME as
			entryShutName,d.ENTRY_DESC as entryDesc,d.ENABLED as enabled,
			d.ENTRY_SIRE as entrySire,d.ENTRY_ORDER as entryOrder,
			(select t.ENTRY_NAME from DICT_CATALOG t where t.CATALOG_ID= d.ENTRY_SIRE) as catalogName
		FROM
			DICT_CATALOG d
		WHERE
			d.ENTRY_TYPE = 1
			<dynamic>
				<isNotEmpty property="entrySire" prepend=" AND">
					d.ENTRY_SIRE = #entrySire#
				</isNotEmpty>
			</dynamic>
		ORDER BY 
			d.ENTRY_SIRE,d.ENTRY_ORDER
		LIMIT
			#start#,#limit#
	</select>
	<select id="list_CatalogIds_ByExample" parameterClass="DictRecord" resultClass="string">
		SELECT 
			CATALOG_ID
		FROM 
			DICT_CATALOG
		WHERE
			ENTRY_TYPE = 1 AND 
			ENTRY_SIRE = #entrySire# AND  
			ENTRY_NAME = #entryName#
	</select>
	<select id="query_record_by_sire" parameterClass="map" resultClass="ComboxModel">
		SELECT
			dc.CATALOG_ID as regValue,dc.ENTRY_NAME as displayValue,
			(select t.ENTRY_SHUTNAME from DICT_CATALOG t where t.CATALOG_ID = dc.ENTRY_SIRE ) AS storName
		FROM
			DICT_CATALOG dc
		WHERE
			dc.ENTRY_TYPE = 1 AND
			dc.ENABLED = 1 AND
			dc.ENTRY_SIRE IN
			(
				SELECT 
					t.CATALOG_ID 
				FROM 
					DICT_CATALOG t 
				 
				<dynamic prepend="where">
					<isNotEmpty property="catalgList" prepend=" ">
						<iterate prepend=" " property="catalgList" open=" t.ENTRY_SHUTNAME IN (" close=")" conjunction=",">
							#catalgList[]#
						</iterate>
					</isNotEmpty>
				</dynamic>
			)
		ORDER BY
			dc.ENTRY_ORDER
	</select>
	<select id="query_recordIds_by_sire" parameterClass="string" resultClass="string">
		SELECT
			dc.CATALOG_ID as recordId
		FROM
			DICT_CATALOG dc
		WHERE
			dc.ENTRY_TYPE = 1 AND
			dc.ENABLED = 1 AND
			dc.ENTRY_SIRE = #value#
	</select>
</sqlMap>
