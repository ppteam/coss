<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE sqlMap      
	PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"      
	"http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="RoleInfo">
	<typeAlias alias="RoleInfo" type="com.neusoft.model.arsd.dao.pojo.RoleInfo"/>
	<!-- Only For Save Action -->
	<insert id="insert" parameterClass="RoleInfo">
		INSERT INTO ROLE_INFO
			(ROLE_ID,ROLE_NAME,ROLE_SIGN,ROLE_DESC,ENABLED)
		VALUES
			(#roleId#,#roleName#,#roleSign#,#roleDesc:VARCHAR#,#enabled#)
	</insert>
	<update id="updateById" parameterClass="RoleInfo">
		UPDATE
			ROLE_INFO
		SET
			ROLE_NAME = #roleName#,
			ROLE_SIGN = #roleSign#,
			ROLE_DESC = #roleDesc:VARCHAR#,
			ENABLED = #enabled#
		WHERE
			ROLE_ID = #roleId#
	</update>
	<select id="query_all_roles_count" parameterClass="map" resultClass="int">
		SELECT
			COUNT(ROLE_ID)
		FROM
			ROLE_INFO
	</select>
	<select id="query_all_roles" parameterClass="map" resultClass="RoleInfo">
		SELECT
			ROLE_ID as roleId,
			ROLE_NAME as roleName,
			ROLE_SIGN as roleSign,
			ROLE_DESC as roleDesc,
			ENABLED as enabled
		FROM
			ROLE_INFO
		LIMIT
			#start#,#limit#
	</select>
	<select id="check_is_exist" parameterClass="RoleInfo" resultClass="string">
		SELECT
			ROLE_ID
		FROM
			ROLE_INFO
		WHERE
			ROLE_NAME = #roleName#
	</select>
	<delete id="delete_map_by_roleId" parameterClass="string">
		DELETE FROM 
			ROLE_MAP_AUTHOR
		WHERE
			ROLE_ID = #value#
	</delete>
	<insert id="role_map_author" parameterClass="map">
		INSERT INTO ROLE_MAP_AUTHOR
			(MAPPING_ID,AUTHOR_ID,ROLE_ID)
		VALUES
			(#mappingId#,#authorId#,#roleId#)
	</insert>
	<select id="query_roles_for_opts" resultClass="ComboxModel">
		SELECT
			t.ROLE_ID as regValue,
			t.ROLE_NAME as displayValue,
			'roleopts' AS storName
		FROM
			ROLE_INFO t
		WHERE
			t.ENABLED = 1
	</select>
	<select id="query_role_by_user" parameterClass="string" resultClass="string">
		SELECT 
			DISTINCT(ri.ROLE_SIGN) 
		FROM 
			user_map_role ump LEFT JOIN role_info ri ON ump.ROLE_ID = ri.ROLE_ID 
		WHERE 
			ri.ENABLED = 1 AND ump.USER_ID = #value# 
	</select>
</sqlMap>
