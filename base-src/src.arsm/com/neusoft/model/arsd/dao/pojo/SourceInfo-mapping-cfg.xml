<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE sqlMap      
	PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"      
	"http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="SourceInfo">
	<typeAlias alias="SourceInfo" type="com.neusoft.model.arsd.dao.pojo.SourceInfo"/>
	<!-- Only For Save Action -->
	<insert id="insert" parameterClass="SourceInfo">
		insert into SCOURCE_INFO
			(SRC_ID,SRC_NAME,SRC_DESC,SRC_ORDER,SRC_TYPE,SRC_SORT,SRC_URL,AUTHOR_ID,ENABLED,STYLECSS)
		values
			(#srcId#,#srcName#,#srcDesc:VARCHAR#,#srcOrder#,#srcType#,
			#srcSort#,#srcUrl:VARCHAR#,#authorId:VARCHAR#,#enabled#,#stylecss:VARCHAR#)
	</insert>
	<update id="updateById" parameterClass="SourceInfo">
		update
			SCOURCE_INFO
		set
			SRC_NAME = #srcName#,SRC_DESC = #srcDesc:VARCHAR#,
			SRC_ORDER = #srcOrder#,SRC_SORT=#srcSort#,
			SRC_URL=#srcUrl:VARCHAR#,AUTHOR_ID=#authorId:VARCHAR#,
			ENABLED = #enabled#,STYLECSS=#stylecss:VARCHAR#
		where
			SRC_ID = #srcId#
	</update>
	<update id="disable_all_submenu" parameterClass="SourceInfo">
		UPDATE
			SCOURCE_INFO
		SET
			ENABLED = 0
		WHERE
			SRC_TYPE = 1 AND
			SRC_SORT = #srcId#
	</update>
	<delete id="remove_by_id" parameterClass="string">
		DELETE FROM
			SCOURCE_INFO
		WHERE
			SRC_ID = #value#
	</delete>
	<select id="select_remove_count" parameterClass="SourceInfo" resultClass="int">
		SELECT
			COUNT(SRC_ID)
		FROM
			SCOURCE_INFO
		WHERE
			SRC_ID = #srcId# OR
			SRC_SORT = #srcId#
	</select>
	<select id="query_for_security" resultClass="InterceptUrlsImpl">
		SELECT 
			SRC_URL as pattern,au.AUTHOR_SIGN as access, '/console/' as prefix
		FROM
			SCOURCE_INFO src LEFT JOIN AUTHORITY_INFO au ON src.AUTHOR_ID = au.AUTHOR_ID
		WHERE
			src.ENABLED = 1 AND
			au.ENABLED = 1
	</select>
	<select id="selectALLSort" resultClass="SourceInfo">
		select
			src.SRC_ID as srcId,
			src.SRC_NAME as srcName,
			src.SRC_DESC as srcDesc,
			src.SRC_ORDER as srcOrder,
			src.SRC_SORT as srcSort,
			src.STYLECSS as stylecss
		from
			SCOURCE_INFO src
		where
			src.SRC_TYPE = 0 
		ORDER BY 
			src.SRC_ORDER
	</select>
	<select id="selectItembySort" parameterClass="SourceInfo"  resultClass="SourceInfo">
		select
			src.SRC_ID as srcId,
			src.SRC_NAME as srcName,
			src.SRC_DESC as srcDesc,
			src.SRC_ORDER as srcOrder,
			src.SRC_SORT as srcSort,
			SRC_URL as srcUrl,
			src.STYLECSS as stylecss
		from
			SCOURCE_INFO src
		where
			src.SRC_SORT = #srcSort# 
		<dynamic>
			<isNotNull prepend=" and">
				ENABLED = #enabled#
			</isNotNull>
		</dynamic>
		ORDER BY
			src.SRC_ORDER
	</select>
	<select id="query_all_sources" resultClass="SourceInfo">
		SELECT
			src.SRC_ID as srcId,
			src.SRC_NAME as srcName,
			src.SRC_DESC as srcDesc,
			src.SRC_ORDER as srcOrder,
			src.SRC_SORT as srcSort,
			src.SRC_URL as srcUrl,
			src.SRC_TYPE as srcType,
			src.ENABLED as enabled,
			src.AUTHOR_ID as authorId,
			src.STYLECSS as stylecss
		FROM
			SCOURCE_INFO src
		ORDER BY
			src.SRC_SORT,src.SRC_TYPE,src.SRC_ORDER
	</select>
	
	<select id="check_isExist_Example" parameterClass="SourceInfo" resultClass="string">
		SELECT
			src.SRC_ID as srcId
		FROM
			SCOURCE_INFO src
		WHERE
			src.SRC_TYPE = #srcType# AND
			src.SRC_NAME = #srcName#
		<dynamic>
			<isNotNull property="srcSort" prepend=" AND">
				src.SRC_SORT = #srcSort#
			</isNotNull>
		</dynamic>
	</select>
	
	<select id="query_for_submenu" parameterClass="map" resultClass="SourceInfo">
		SELECT
			src.SRC_ID as srcId,
			src.SRC_NAME as srcName,
			src.SRC_DESC as srcDesc,
			src.SRC_ORDER as srcOrder,
			src.SRC_SORT as srcSort,
			src.SRC_URL as srcUrl,
			src.SRC_TYPE as srcType,
			src.STYLECSS as stylecss
		FROM
			SCOURCE_INFO src
		WHERE
			src.SRC_TYPE = 1 AND
			src.ENABLED = 1 
		<dynamic>
			<isNotEmpty property="menuList" prepend=" AND">
				<iterate property="menuList" conjunction="," open="src.SRC_SORT in (" close=")">
					#menuList[]#
				</iterate>
			</isNotEmpty>
		</dynamic>
		ORDER BY
			src.SRC_ORDER
	</select>
	<select id="query_for_menu_by_authors" parameterClass="map" resultClass="MenuModle">
		SELECT 
			s.SRC_ID as menuId,
			s.SRC_NAME as menuName,
			s.SRC_URL as menuValue,
			(
				SELECT t.SRC_NAME FROM SCOURCE_INFO t WHERE t.SRC_ID = s.SRC_SORT
			) as superName,
			s.STYLECSS as stylecss,
			(
				SELECT u.STYLECSS FROM SCOURCE_INFO u WHERE u.SRC_ID = s.SRC_SORT
			) as menuCss
		FROM
			SCOURCE_INFO s
		WHERE 
			s.SRC_TYPE = 1 AND
			s.ENABLED = 1
		<dynamic>
			<isNotEmpty property="KEY_AUTHORS" prepend=" AND">
				<iterate property="KEY_AUTHORS" conjunction="," 
					open="s.AUTHOR_ID IN  (SELECT a.AUTHOR_ID FROM AUTHORITY_INFO a WHERE a.AUTHOR_SIGN IN (" close="))">
					#KEY_AUTHORS[]#
				</iterate>
			</isNotEmpty>
		</dynamic>
		ORDER BY
			s.SRC_SORT,s.SRC_ORDER
	</select>
	<select id="query_for_menu" parameterClass="map" resultClass="MenuModle">
		SELECT 
			s.SRC_ID as menuId,
			s.SRC_NAME as menuName,
			s.SRC_URL as menuValue,
			(
				SELECT t.SRC_NAME FROM SCOURCE_INFO t WHERE t.SRC_ID = s.SRC_SORT
			) as superName,
			s.STYLECSS as stylecss
		FROM
			SCOURCE_INFO s
		WHERE 
			s.SRC_TYPE = 1 AND
			s.ENABLED = 1
		ORDER BY
			s.SRC_SORT,s.SRC_ORDER
	</select>
</sqlMap>
