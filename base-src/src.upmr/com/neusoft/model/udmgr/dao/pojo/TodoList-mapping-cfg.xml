<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE sqlMap      
	PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"      
	"http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="TodoList">
	<typeAlias alias="TodoList" type="com.neusoft.model.udmgr.dao.pojo.TodoList"/>
	<!-- Only For Save Action -->
	<insert id="insert" parameterClass="TodoList">
		INSERT INTO TODO_LIST
			(TODO_ID,USER_ID,ENTYR_DATE,DEAD_DATE,TODO_DES,STATUS)
		VALUES
			(#todoId#,#userId#,CURRENT_DATE(),#deadDate#,#todoDes#,#status#)
	</insert>
	<update id="updateById" parameterClass="TodoList">
		UPDATE
			TODO_LIST
		SET
			DEAD_DATE = #deadDate#,
			TODO_DES = #todoDes#,
			STATUS = #status#
		WHERE
			TODO_ID = #todoId#
	</update>
	<select id="query_todo_seft_list" parameterClass="map" resultClass="TodoList">
		SELECT
			TODO_ID as todoId,USER_ID as userId,ENTYR_DATE as entryDate,
			DEAD_DATE as deadDate,TODO_DES as todoDes ,STATUS as status,
			IF(CURRENT_DATE() > DEAD_DATE,1,0) as overTag,0 as todoType
		FROM
			TODO_LIST
		WHERE
			USER_ID = #KEY_USERID# AND 
			STATUS = 0
		ORDER BY ENTYR_DATE DESC
	</select>
	<select id="query_todo_dreport_list" parameterClass="map" resultClass="TodoList">
		SELECT 
			c.DETAIL_ID AS todoId,c.USER_ID AS userId,c.CHECK_DATE AS entryDate,
			c.CHECK_DATE as deadDate,'童鞋，请完成当日日报填写。' AS todoDes, 0 AS status,
			IF(CURRENT_DATE() > c.CHECK_DATE,1,0) AS overTag,1 AS todoType
		FROM 
			CHECK_DETAIL c 
		WHERE
			c.CHECK_DATE >= '2011-08-01' AND
			(SELECT COUNT(e.RECORDOR_ID) FROM EDAILY_REPORT e  WHERE e.USER_ID= c.USER_ID AND e.REPORT_DATE=c.CHECK_DATE) = 0 AND
			c.USER_ID = #KEY_USERID#
		ORDER BY c.CHECK_DATE DESC
		LIMIT 0,100
	</select>
</sqlMap>
